<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thierry Carles - Gestion du Personnel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3d3573;
            --secondary: #e84597;
            --accent: #c1439d;
            --bg-dark: #1a1633;
            --bg-light: #f8f7fc;
            --text-dark: #2a2547;
            --text-light: #6b6885;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #e8e6f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, #fff 100%);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app { max-width: 1400px; margin: 0 auto; padding: 20px; }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #2d2558 100%);
            padding: 24px 32px;
            border-radius: 20px;
            margin-bottom: 28px;
            box-shadow: 0 20px 60px rgba(61, 53, 115, 0.25);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: -50%; right: -10%;
            width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(232, 69, 151, 0.15) 0%, transparent 70%);
            border-radius: 50%;
        }
        .header-left { display: flex; align-items: center; gap: 16px; position: relative; z-index: 1; }
        .header-logo { height: 60px; filter: brightness(0) invert(1); }
        .header-title { color: white; font-family: 'Manrope', sans-serif; }
        .header-title h1 { font-size: 24px; font-weight: 800; margin-bottom: 2px; }
        .header-title p { font-size: 13px; opacity: 0.8; font-weight: 400; }
        .header-actions { display: flex; gap: 8px; align-items: center; position: relative; z-index: 1; flex-wrap: wrap; justify-content: flex-end; }

        .logout-btn {
            background: rgba(255,255,255,0.15); color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 9px 16px; border-radius: 10px;
            cursor: pointer; font-weight: 600; font-size: 13px;
            transition: all 0.3s ease; backdrop-filter: blur(10px);
        }
        .logout-btn:hover { background: rgba(255,255,255,0.25); transform: translateY(-1px); }
        .unsaved-badge {
            background: rgba(255,193,7,0.2); color: #fff;
            padding: 7px 12px; border-radius: 8px; font-size: 12px;
            font-weight: 600; border: 1px solid rgba(255,193,7,0.3);
        }

        /* ===== LOGIN ===== */
        .login-page {
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #1a1633 0%, #2d2558 50%, #3d3573 100%);
            position: relative; overflow: hidden;
        }
        .login-page::before {
            content: ''; position: absolute;
            top: -30%; left: -20%; width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(232,69,151,0.12) 0%, transparent 70%);
            border-radius: 50%;
        }
        .login-page::after {
            content: ''; position: absolute;
            bottom: -25%; right: -15%; width: 500px; height: 500px;
            background: radial-gradient(circle, rgba(61,53,115,0.3) 0%, transparent 70%);
            border-radius: 50%;
        }
        .login-container {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            padding: 48px 42px 42px; border-radius: 28px;
            max-width: 420px; width: 90%;
            box-shadow: 0 30px 80px rgba(0,0,0,0.2);
            position: relative; z-index: 1;
        }
        .login-logo-wrap { text-align: center; margin-bottom: 28px; }
        .login-logo { max-height: 80px; max-width: 100%; }
        .login-container h2 {
            color: var(--primary); margin-bottom: 6px;
            font-size: 26px; font-weight: 800;
            font-family: 'Manrope', sans-serif; text-align: center;
        }
        .login-container > p {
            color: var(--text-light); margin-bottom: 28px;
            font-size: 14px; text-align: center;
        }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 7px; color: var(--text-dark); font-weight: 600; font-size: 13px; }
        .input-group input {
            width: 100%; padding: 13px 15px;
            border: 2px solid var(--border); border-radius: 12px;
            font-size: 14px; transition: all 0.3s ease;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        .input-group input:focus { outline: none; border-color: var(--secondary); box-shadow: 0 0 0 4px rgba(232,69,151,0.1); }

        .primary-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white; border: none; padding: 14px; border-radius: 12px;
            font-weight: 700; font-size: 15px; cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(232,69,151,0.3);
        }
        .primary-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 28px rgba(232,69,151,0.4); }

        /* ===== TABS ===== */
        .tabs {
            display: flex; gap: 8px; margin-bottom: 24px;
            background: white; padding: 6px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            flex-wrap: wrap;
        }
        .tab {
            padding: 11px 20px; border-radius: 12px;
            cursor: pointer; font-weight: 600; font-size: 13px;
            transition: all 0.3s ease;
            background: transparent; border: none;
            color: var(--text-light);
            flex: 1; min-width: 140px;
        }
        .tab.active {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white;
            box-shadow: 0 6px 16px rgba(232,69,151,0.3);
        }

        /* ===== CARDS ===== */
        .card {
            background: white;
            padding: 28px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            margin-bottom: 20px;
        }
        .card h3 {
            color: var(--primary);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 18px;
            font-family: 'Manrope', sans-serif;
        }

        /* ===== DASHBOARD SPECIFIC ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
            padding: 24px;
            border-radius: 16px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(61, 53, 115, 0.12);
            border-color: var(--secondary);
        }

        .dashboard-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .dashboard-card-header h4 {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
            font-family: 'Manrope', sans-serif;
        }

        .chantier-badge {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
        }

        .chantier-details {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 14px;
        }

        .chantier-details p {
            margin: 4px 0;
        }

        .chantier-location {
            display: flex;
            align-items: start;
            gap: 6px;
            margin: 8px 0;
        }

        .employee-list {
            margin-top: 14px;
        }

        .employee-list-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .employee-item {
            background: rgba(61, 53, 115, 0.04);
            padding: 10px 12px;
            border-radius: 10px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid var(--secondary);
        }

        .employee-item-info {
            flex: 1;
        }

        .employee-name {
            font-weight: 600;
            font-size: 13px;
            color: var(--text-dark);
        }

        .employee-dates {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 2px;
        }

        .conge-card {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border: 2px solid #fecaca;
        }

        .conge-card:hover {
            border-color: var(--danger);
        }

        .conge-badge {
            background: var(--danger);
        }

        .conge-item {
            background: rgba(239, 68, 68, 0.08);
            border-left-color: var(--danger);
        }

        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-light);
            font-size: 14px;
        }

        /* ===== BUTTONS ===== */
        .btn {
            padding: 10px 18px; border-radius: 10px;
            font-weight: 600; font-size: 13px;
            cursor: pointer; border: none;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white;
            box-shadow: 0 6px 16px rgba(232,69,151,0.3);
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(232,69,151,0.4); }
        .btn-secondary { background: var(--bg-light); color: var(--text-dark); }
        .btn-secondary:hover { background: var(--border); }
        .btn-edit { background: var(--primary); color: white; }
        .btn-edit:hover { background: #2d2558; }
        .btn-delete { background: var(--danger); color: white; }
        .btn-delete:hover { background: #dc2626; }

        /* ===== TABLES ===== */
        .table-container { overflow-x: auto; margin-top: 16px; }
        table {
            width: 100%; border-collapse: collapse;
            background: white;
        }
        th, td { padding: 13px 16px; text-align: left; }
        th {
            background: linear-gradient(135deg, var(--primary) 0%, #2d2558 100%);
            color: white; font-weight: 600; font-size: 13px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }
        tbody tr:hover { background: var(--bg-light); }
        td { font-size: 13px; color: var(--text-dark); }

        /* ===== FORMS ===== */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .form-group { margin-bottom: 18px; }
        .form-group label { display: block; margin-bottom: 7px; color: var(--text-dark); font-weight: 600; font-size: 13px; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 11px 14px;
            border: 2px solid var(--border); border-radius: 10px;
            font-size: 14px; transition: all 0.3s ease;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(232,69,151,0.1);
        }

        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); display: flex;
            align-items: center; justify-content: center;
            z-index: 1000; backdrop-filter: blur(4px);
        }
        .modal {
            background: white; padding: 32px; border-radius: 20px;
            max-width: 600px; width: 90%; max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0,0,0,0.3);
        }
        .modal h3 {
            color: var(--primary); font-size: 22px;
            font-weight: 700; margin-bottom: 20px;
            font-family: 'Manrope', sans-serif;
        }
        .modal-actions {
            display: flex; gap: 10px; margin-top: 24px;
            justify-content: flex-end;
        }

        /* ===== BADGES ===== */
        .badge {
            display: inline-block;
            padding: 5px 11px; border-radius: 8px;
            font-size: 11px; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .badge-success { background: rgba(16,185,129,0.1); color: var(--success); }
        .badge-warning { background: rgba(245,158,11,0.1); color: var(--warning); }
        .badge-danger { background: rgba(239,68,68,0.1); color: var(--danger); }
        .badge-zone {
            background: linear-gradient(135deg, rgba(61,53,115,0.1) 0%, rgba(232,69,151,0.1) 100%);
            color: var(--primary);
        }

        /* ===== CHANTIER ITEMS ===== */
        .chantier-item {
            background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
            padding: 20px; border-radius: 16px; margin-bottom: 16px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }
        .chantier-item:hover {
            border-color: var(--secondary);
            box-shadow: 0 8px 24px rgba(61, 53, 115, 0.12);
        }
        .chantier-header {
            display: flex; justify-content: space-between;
            align-items: flex-start; margin-bottom: 12px;
        }
        .chantier-info h4 {
            color: var(--primary); font-size: 16px;
            font-weight: 700; margin-bottom: 6px;
        }
        .chantier-info p {
            color: var(--text-light); font-size: 13px;
            margin: 3px 0;
        }

        .employee-assignments {
            margin-top: 16px; padding-top: 16px;
            border-top: 2px solid var(--border);
        }
        .assignment-item {
            background: rgba(61,53,115,0.04);
            padding: 12px; border-radius: 10px;
            margin-bottom: 8px;
            border-left: 3px solid var(--secondary);
        }

        /* ===== EXPORT ===== */
        .export-section { margin-top: 20px; }
        .export-section h4 {
            color: var(--primary); font-size: 16px;
            font-weight: 700; margin-bottom: 8px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 16px; text-align: center; }
            .header-left { flex-direction: column; }
            .header-actions { width: 100%; justify-content: center; }
            .tabs { flex-direction: column; }
            .tab { min-width: auto; }
            .form-grid { grid-template-columns: 1fr; }
            .dashboard-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ‚îÄ‚îÄ‚îÄ LOGO AS BASE64 ‚îÄ‚îÄ‚îÄ
        const LOGO_BASE64 = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8dGV4dCB4PSIyMCIgeT0iNjAiIGZvbnQtZmFtaWx5PSJNYW5yb3BlLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQ4IiBmb250LXdlaWdodD0iODAwIiBmaWxsPSIjM2QzNTczIj5UaGllcnJ5IENhcmxlczwvdGV4dD4KPC9zdmc+';

        // ‚îÄ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ
        function App() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [employees, setEmployees] = useState([]);
            const [chantiers, setChantiers] = useState([]);
            const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);

            useEffect(() => {
                const savedData = localStorage.getItem('thierryCarlesData');
                if (savedData) {
                    const { employees: emp, chantiers: chan } = JSON.parse(savedData);
                    setEmployees(emp || []);
                    setChantiers(chan || []);
                }
            }, []);

            const saveToLocalStorage = (emp, chan) => {
                localStorage.setItem('thierryCarlesData', JSON.stringify({
                    employees: emp || employees,
                    chantiers: chan || chantiers
                }));
                setHasUnsavedChanges(false);
            };

            const handleLogin = (username, password) => {
                if (username === 'admin' && password === 'admin') {
                    setIsLoggedIn(true);
                    return true;
                }
                return false;
            };

            const handleLogout = () => {
                if (!hasUnsavedChanges || confirm('Vous avez des modifications non enregistr√©es. Voulez-vous vraiment vous d√©connecter ?')) {
                    setIsLoggedIn(false);
                }
            };

            const exportPlanning = (employeeId) => {
                const employee = employees.find(e => e.id === employeeId);
                if (!employee) return;

                const wb = XLSX.utils.book_new();
                const year = new Date().getFullYear();

                // R√©cup√©rer toutes les assignations et cong√©s de l'employ√©
                const assignments = [];
                const conges = employee.conges || [];

                chantiers.forEach(chantier => {
                    if (chantier.employees) {
                        chantier.employees.forEach(assignment => {
                            if (assignment.employeeId === employeeId) {
                                assignments.push({
                                    type: 'Chantier',
                                    nom: chantier.nom,
                                    lieu: chantier.lieu,
                                    dateDebut: assignment.dateDebut,
                                    dateFin: assignment.dateFin,
                                    zone: chantier.zone || 'N/A',
                                    panier: chantier.panier || 0
                                });
                            }
                        });
                    }
                });

                // Cr√©er un onglet par mois
                for (let month = 0; month < 12; month++) {
                    const monthName = new Date(year, month, 1).toLocaleDateString('fr-FR', { month: 'long' });
                    const daysInMonth = new Date(year, month + 1, 0).getDate();

                    const data = [
                        ['PLANNING - ' + monthName.toUpperCase() + ' ' + year],
                        ['Employ√©:', employee.nom],
                        [],
                        ['Jour', 'Date', 'Type', 'Chantier/Cong√©', 'Lieu', 'Zone', 'Panier']
                    ];

                    for (let day = 1; day <= daysInMonth; day++) {
                        const date = new Date(year, month, day);
                        const dateStr = date.toISOString().split('T')[0];
                        const dayName = date.toLocaleDateString('fr-FR', { weekday: 'short' });

                        let rowData = [dayName, date.toLocaleDateString('fr-FR'), '', '', '', '', ''];

                        // V√©rifier si c'est un cong√©
                        const conge = conges.find(c => dateStr >= c.dateDebut && dateStr <= c.dateFin);
                        if (conge) {
                            rowData = [dayName, date.toLocaleDateString('fr-FR'), 'Cong√©', conge.type || 'CP', '-', '-', '-'];
                        } else {
                            // V√©rifier si c'est un chantier
                            const assignment = assignments.find(a => dateStr >= a.dateDebut && dateStr <= a.dateFin);
                            if (assignment) {
                                rowData = [
                                    dayName,
                                    date.toLocaleDateString('fr-FR'),
                                    'Chantier',
                                    assignment.nom,
                                    assignment.lieu,
                                    assignment.zone,
                                    assignment.panier + '‚Ç¨'
                                ];
                            }
                        }

                        data.push(rowData);
                    }

                    const ws = XLSX.utils.aoa_to_sheet(data);

                    // Largeurs des colonnes
                    ws['!cols'] = [
                        { wch: 8 },  // Jour
                        { wch: 12 }, // Date
                        { wch: 10 }, // Type
                        { wch: 30 }, // Chantier/Cong√©
                        { wch: 40 }, // Lieu
                        { wch: 8 },  // Zone
                        { wch: 10 }  // Panier
                    ];

                    // Styles et couleurs
                    const range = XLSX.utils.decode_range(ws['!ref']);
                    
                    // Style pour l'en-t√™te du mois (ligne 1)
                    for (let C = range.s.c; C <= range.e.c; ++C) {
                        const address = XLSX.utils.encode_cell({ r: 0, c: C });
                        if (!ws[address]) continue;
                        ws[address].s = {
                            font: { bold: true, sz: 16, color: { rgb: "FFFFFF" } },
                            fill: { fgColor: { rgb: "3D3573" } },
                            alignment: { horizontal: "center", vertical: "center" }
                        };
                    }

                    // Style pour les informations employ√© (ligne 2)
                    for (let C = range.s.c; C <= range.e.c; ++C) {
                        const address = XLSX.utils.encode_cell({ r: 1, c: C });
                        if (!ws[address]) continue;
                        ws[address].s = {
                            font: { bold: true, sz: 12 },
                            fill: { fgColor: { rgb: "F8F7FC" } }
                        };
                    }

                    // Style pour l'en-t√™te des colonnes (ligne 4)
                    for (let C = range.s.c; C <= range.e.c; ++C) {
                        const address = XLSX.utils.encode_cell({ r: 3, c: C });
                        if (!ws[address]) continue;
                        ws[address].s = {
                            font: { bold: true, color: { rgb: "FFFFFF" } },
                            fill: { fgColor: { rgb: "E84597" } },
                            alignment: { horizontal: "center", vertical: "center" }
                        };
                    }

                    // Style pour les donn√©es (lignes 5+)
                    for (let R = 4; R <= range.e.r; ++R) {
                        for (let C = range.s.c; C <= range.e.c; ++C) {
                            const address = XLSX.utils.encode_cell({ r: R, c: C });
                            if (!ws[address]) continue;

                            const typeCell = XLSX.utils.encode_cell({ r: R, c: 2 });
                            const type = ws[typeCell] ? ws[typeCell].v : '';

                            let fillColor = "FFFFFF";
                            let fontColor = "2A2547";

                            if (type === 'Cong√©') {
                                fillColor = "FFE8E8";
                                fontColor = "EF4444";
                            } else if (type === 'Chantier') {
                                fillColor = "F8F9FF";
                                fontColor = "3D3573";
                            }

                            // Alterner les couleurs pour meilleure lisibilit√©
                            if (R % 2 === 0 && type === '') {
                                fillColor = "F8F7FC";
                            }

                            ws[address].s = {
                                font: { color: { rgb: fontColor } },
                                fill: { fgColor: { rgb: fillColor } },
                                alignment: { horizontal: "left", vertical: "center" },
                                border: {
                                    top: { style: "thin", color: { rgb: "E8E6F0" } },
                                    bottom: { style: "thin", color: { rgb: "E8E6F0" } },
                                    left: { style: "thin", color: { rgb: "E8E6F0" } },
                                    right: { style: "thin", color: { rgb: "E8E6F0" } }
                                }
                            };
                        }
                    }

                    XLSX.utils.book_append_sheet(wb, ws, monthName);
                }

                // Onglet r√©sum√© CP
                const totalConges = conges.reduce((sum, c) => {
                    const start = new Date(c.dateDebut);
                    const end = new Date(c.dateFin);
                    const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                    return sum + days;
                }, 0);

                const resumeData = [
                    ['R√âSUM√â CONG√âS ' + year],
                    ['Employ√©:', employee.nom],
                    [],
                    ['Type', 'Date d√©but', 'Date fin', 'Jours'],
                    ...conges.map(c => {
                        const start = new Date(c.dateDebut);
                        const end = new Date(c.dateFin);
                        const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                        return [
                            c.type || 'CP',
                            start.toLocaleDateString('fr-FR'),
                            end.toLocaleDateString('fr-FR'),
                            days
                        ];
                    }),
                    [],
                    ['TOTAL JOURS:', '', '', totalConges]
                ];

                const resumeWs = XLSX.utils.aoa_to_sheet(resumeData);
                resumeWs['!cols'] = [{ wch: 20 }, { wch: 15 }, { wch: 15 }, { wch: 10 }];

                // Styles pour le r√©sum√©
                const resumeRange = XLSX.utils.decode_range(resumeWs['!ref']);
                
                // En-t√™te
                for (let C = resumeRange.s.c; C <= resumeRange.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: 0, c: C });
                    if (!resumeWs[address]) continue;
                    resumeWs[address].s = {
                        font: { bold: true, sz: 16, color: { rgb: "FFFFFF" } },
                        fill: { fgColor: { rgb: "3D3573" } },
                        alignment: { horizontal: "center" }
                    };
                }

                // Colonnes
                for (let C = resumeRange.s.c; C <= resumeRange.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: 3, c: C });
                    if (!resumeWs[address]) continue;
                    resumeWs[address].s = {
                        font: { bold: true, color: { rgb: "FFFFFF" } },
                        fill: { fgColor: { rgb: "E84597" } },
                        alignment: { horizontal: "center" }
                    };
                }

                // Ligne total
                const totalRow = resumeData.length - 1;
                for (let C = resumeRange.s.c; C <= resumeRange.e.c; ++C) {
                    const address = XLSX.utils.encode_cell({ r: totalRow, c: C });
                    if (!resumeWs[address]) continue;
                    resumeWs[address].s = {
                        font: { bold: true, sz: 12, color: { rgb: "FFFFFF" } },
                        fill: { fgColor: { rgb: "10B981" } },
                        alignment: { horizontal: "right" }
                    };
                }

                XLSX.utils.book_append_sheet(wb, resumeWs, 'R√©sum√© CP');

                XLSX.writeFile(wb, `Planning_${employee.nom.replace(/\s+/g, '_')}_${year}.xlsx`);
            };

            if (!isLoggedIn) {
                return <LoginPage onLogin={handleLogin} />;
            }

            return (
                <div className="app">
                    <header className="header">
                        <div className="header-left">
                            <img src={LOGO_BASE64} alt="Logo Thierry Carles" className="header-logo" />
                            <div className="header-title">
                                <h1>Thierry Carles</h1>
                                <p>Gestion du Personnel & Chantiers</p>
                            </div>
                        </div>
                        <div className="header-actions">
                            {hasUnsavedChanges && <span className="unsaved-badge">‚ö†Ô∏è Non enregistr√©</span>}
                            <button className="logout-btn" onClick={() => saveToLocalStorage()}>üíæ Enregistrer</button>
                            <button className="logout-btn" onClick={handleLogout}>üö™ D√©connexion</button>
                        </div>
                    </header>

                    <div className="tabs">
                        <button className={`tab ${activeTab === 'dashboard' ? 'active' : ''}`} onClick={() => setActiveTab('dashboard')}>üìä Tableau de bord</button>
                        <button className={`tab ${activeTab === 'employees' ? 'active' : ''}`} onClick={() => setActiveTab('employees')}>üë• Employ√©s</button>
                        <button className={`tab ${activeTab === 'chantiers' ? 'active' : ''}`} onClick={() => setActiveTab('chantiers')}>üèóÔ∏è Chantiers</button>
                        <button className={`tab ${activeTab === 'export' ? 'active' : ''}`} onClick={() => setActiveTab('export')}>üì• Export</button>
                    </div>

                    {activeTab === 'dashboard' && (
                        <DashboardTab
                            employees={employees}
                            chantiers={chantiers}
                        />
                    )}

                    {activeTab === 'employees' && (
                        <EmployeesTab
                            employees={employees}
                            setEmployees={(emp) => { setEmployees(emp); setHasUnsavedChanges(true); }}
                        />
                    )}

                    {activeTab === 'chantiers' && (
                        <ChantiersTab
                            chantiers={chantiers}
                            employees={employees}
                            setChantiers={(chan) => { setChantiers(chan); setHasUnsavedChanges(true); }}
                        />
                    )}

                    {activeTab === 'export' && (
                        <ExportTab
                            employees={employees}
                            onExport={exportPlanning}
                        />
                    )}
                </div>
            );
        }

        // ‚îÄ‚îÄ‚îÄ LOGIN PAGE ‚îÄ‚îÄ‚îÄ
        function LoginPage({ onLogin }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!onLogin(username, password)) {
                    setError('Identifiants incorrects');
                }
            };

            return (
                <div className="login-page">
                    <div className="login-container">
                        <div className="login-logo-wrap">
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==" alt="Logo" className="login-logo" style={{display: 'none'}} />
                        </div>
                        <h2>Connexion</h2>
                        <p>Acc√©dez √† votre espace de gestion</p>
                        {error && <p style={{ color: 'var(--danger)', marginBottom: '15px', textAlign: 'center', fontSize: '13px' }}>{error}</p>}
                        <form onSubmit={handleSubmit}>
                            <div className="input-group">
                                <label>Nom d'utilisateur</label>
                                <input
                                    type="text"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    placeholder="Entrez votre nom d'utilisateur"
                                    required
                                />
                            </div>
                            <div className="input-group">
                                <label>Mot de passe</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Entrez votre mot de passe"
                                    required
                                />
                            </div>
                            <button type="submit" className="primary-btn">Se connecter</button>
                        </form>
                    </div>
                </div>
            );
        }

        // ‚îÄ‚îÄ‚îÄ DASHBOARD TAB ‚îÄ‚îÄ‚îÄ
        function DashboardTab({ employees, chantiers }) {
            const today = new Date().toISOString().split('T')[0];

            // Chantiers en cours (qui contiennent la date d'aujourd'hui)
            const chantiersEnCours = chantiers.filter(c => 
                c.dateDebut <= today && c.dateFin >= today
            );

            // Employ√©s en cong√© aujourd'hui
            const employesEnConge = employees.filter(emp => {
                if (!emp.conges || emp.conges.length === 0) return false;
                return emp.conges.some(conge => 
                    conge.dateDebut <= today && conge.dateFin >= today
                );
            }).map(emp => {
                const conge = emp.conges.find(c => c.dateDebut <= today && c.dateFin >= today);
                return { ...emp, congeActuel: conge };
            });

            return (
                <div>
                    <div className="card">
                        <h3>üìä Aper√ßu d'aujourd'hui - {new Date().toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</h3>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px', marginTop: '20px' }}>
                            <div style={{ background: 'linear-gradient(135deg, #3d3573 0%, #2d2558 100%)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                                <div style={{ fontSize: '32px', fontWeight: '800', marginBottom: '4px' }}>{chantiersEnCours.length}</div>
                                <div style={{ fontSize: '13px', opacity: '0.9' }}>Chantiers actifs</div>
                            </div>
                            <div style={{ background: 'linear-gradient(135deg, #e84597 0%, #c1439d 100%)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                                <div style={{ fontSize: '32px', fontWeight: '800', marginBottom: '4px' }}>
                                    {chantiersEnCours.reduce((sum, c) => sum + (c.employees?.length || 0), 0)}
                                </div>
                                <div style={{ fontSize: '13px', opacity: '0.9' }}>Employ√©s sur chantier</div>
                            </div>
                            <div style={{ background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                                <div style={{ fontSize: '32px', fontWeight: '800', marginBottom: '4px' }}>{employesEnConge.length}</div>
                                <div style={{ fontSize: '13px', opacity: '0.9' }}>Employ√©s en cong√©</div>
                            </div>
                            <div style={{ background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', padding: '20px', borderRadius: '12px', color: 'white' }}>
                                <div style={{ fontSize: '32px', fontWeight: '800', marginBottom: '4px' }}>{employees.length}</div>
                                <div style={{ fontSize: '13px', opacity: '0.9' }}>Total employ√©s</div>
                            </div>
                        </div>
                    </div>

                    <div className="dashboard-grid">
                        <div>
                            <h3 style={{ color: 'var(--primary)', fontSize: '18px', fontWeight: '700', marginBottom: '16px', fontFamily: 'Manrope, sans-serif' }}>
                                üèóÔ∏è Chantiers en cours
                            </h3>
                            {chantiersEnCours.length === 0 ? (
                                <div className="no-data">
                                    <p>Aucun chantier actif aujourd'hui</p>
                                </div>
                            ) : (
                                chantiersEnCours.map(chantier => (
                                    <div key={chantier.id} className="dashboard-card">
                                        <div className="dashboard-card-header">
                                            <h4>{chantier.nom}</h4>
                                            <span className="chantier-badge">Actif</span>
                                        </div>
                                        <div className="chantier-details">
                                            <div className="chantier-location">
                                                <span>üìç</span>
                                                <p>{chantier.lieu}</p>
                                            </div>
                                            <p>üìÖ Du {new Date(chantier.dateDebut + 'T00:00:00').toLocaleDateString('fr-FR')} au {new Date(chantier.dateFin + 'T00:00:00').toLocaleDateString('fr-FR')}</p>
                                            {chantier.zone && <p>üó∫Ô∏è Zone {chantier.zone} ‚Ä¢ Panier: {chantier.panier}‚Ç¨</p>}
                                        </div>
                                        {chantier.employees && chantier.employees.length > 0 && (
                                            <div className="employee-list">
                                                <div className="employee-list-title">üë∑ Employ√©s assign√©s ({chantier.employees.length})</div>
                                                {chantier.employees.map(assignment => {
                                                    const emp = employees.find(e => e.id === assignment.employeeId);
                                                    return emp ? (
                                                        <div key={assignment.id} className="employee-item">
                                                            <div className="employee-item-info">
                                                                <div className="employee-name">{emp.nom}</div>
                                                                <div className="employee-dates">
                                                                    üìÖ {new Date(assignment.dateDebut + 'T00:00:00').toLocaleDateString('fr-FR')} ‚Üí {new Date(assignment.dateFin + 'T00:00:00').toLocaleDateString('fr-FR')}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ) : null;
                                                })}
                                            </div>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>

                        <div>
                            <h3 style={{ color: 'var(--danger)', fontSize: '18px', fontWeight: '700', marginBottom: '16px', fontFamily: 'Manrope, sans-serif' }}>
                                üèñÔ∏è Employ√©s en cong√©
                            </h3>
                            {employesEnConge.length === 0 ? (
                                <div className="no-data">
                                    <p>Aucun employ√© en cong√© aujourd'hui</p>
                                </div>
                            ) : (
                                employesEnConge.map(emp => (
                                    <div key={emp.id} className="dashboard-card conge-card">
                                        <div className="dashboard-card-header">
                                            <h4>{emp.nom}</h4>
                                            <span className="conge-badge chantier-badge">En cong√©</span>
                                        </div>
                                        <div className="employee-list">
                                            <div className="conge-item employee-item">
                                                <div className="employee-item-info">
                                                    <div className="employee-name">{emp.congeActuel.type || 'Cong√© pay√©'}</div>
                                                    <div className="employee-dates">
                                                        üìÖ Du {new Date(emp.congeActuel.dateDebut + 'T00:00:00').toLocaleDateString('fr-FR')} au {new Date(emp.congeActuel.dateFin + 'T00:00:00').toLocaleDateString('fr-FR')}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // ‚îÄ‚îÄ‚îÄ EMPLOYEES TAB ‚îÄ‚îÄ‚îÄ
        function EmployeesTab({ employees, setEmployees }) {
            const [showModal, setShowModal] = useState(false);
            const [showCongeModal, setShowCongeModal] = useState(false);
            const [editingEmployee, setEditingEmployee] = useState(null);
            const [selectedEmployee, setSelectedEmployee] = useState(null);

            const handleSaveEmployee = (employeeData) => {
                if (editingEmployee) {
                    setEmployees(employees.map(e => e.id === editingEmployee.id ? { ...employeeData, id: e.id, conges: e.conges } : e));
                } else {
                    setEmployees([...employees, { ...employeeData, id: Date.now(), conges: [] }]);
                }
                setShowModal(false);
                setEditingEmployee(null);
            };

            const handleDeleteEmployee = (id) => {
                if (confirm('√ätes-vous s√ªr de vouloir supprimer cet employ√© ?')) {
                    setEmployees(employees.filter(e => e.id !== id));
                }
            };

            const handleAddConge = (employeeId) => {
                const emp = employees.find(e => e.id === employeeId);
                setSelectedEmployee(emp);
                setShowCongeModal(true);
            };

            const handleSaveConge = (congeData) => {
                setEmployees(employees.map(emp => {
                    if (emp.id === selectedEmployee.id) {
                        return {
                            ...emp,
                            conges: [...(emp.conges || []), { ...congeData, id: Date.now() }]
                        };
                    }
                    return emp;
                }));
                setShowCongeModal(false);
                setSelectedEmployee(null);
            };

            const handleDeleteConge = (employeeId, congeId) => {
                if (confirm('Supprimer ce cong√© ?')) {
                    setEmployees(employees.map(emp => {
                        if (emp.id === employeeId) {
                            return {
                                ...emp,
                                conges: emp.conges.filter(c => c.id !== congeId)
                            };
                        }
                        return emp;
                    }));
                }
            };

            return (
                <div>
                    <div className="card">
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                            <h3>Gestion des employ√©s</h3>
                            <button className="btn btn-primary" onClick={() => setShowModal(true)}>+ Ajouter un employ√©</button>
                        </div>

                        {employees.length === 0 ? (
                            <p style={{ textAlign: 'center', color: 'var(--text-light)', padding: '40px 0' }}>Aucun employ√© enregistr√©</p>
                        ) : (
                            <div className="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Qualification</th>
                                            <th>T√©l√©phone</th>
                                            <th>Email</th>
                                            <th>Cong√©s</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {employees.map(emp => (
                                            <React.Fragment key={emp.id}>
                                                <tr>
                                                    <td><strong>{emp.nom}</strong></td>
                                                    <td>{emp.qualification}</td>
                                                    <td>{emp.telephone}</td>
                                                    <td>{emp.email}</td>
                                                    <td>
                                                        <span className="badge badge-success">{emp.conges?.length || 0} p√©riode(s)</span>
                                                    </td>
                                                    <td>
                                                        <div style={{ display: 'flex', gap: '6px' }}>
                                                            <button className="btn btn-secondary" style={{ padding: '6px 12px', fontSize: '12px' }} onClick={() => handleAddConge(emp.id)}>+ Cong√©</button>
                                                            <button className="btn btn-edit" style={{ padding: '6px 12px', fontSize: '12px' }} onClick={() => { setEditingEmployee(emp); setShowModal(true); }}>Modifier</button>
                                                            <button className="btn btn-delete" style={{ padding: '6px 12px', fontSize: '12px' }} onClick={() => handleDeleteEmployee(emp.id)}>Supprimer</button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {emp.conges && emp.conges.length > 0 && (
                                                    <tr>
                                                        <td colSpan="6" style={{ background: 'var(--bg-light)', padding: '12px 16px' }}>
                                                            <strong style={{ fontSize: '12px', color: 'var(--primary)', marginBottom: '8px', display: 'block' }}>P√©riodes de cong√© :</strong>
                                                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                                                                {emp.conges.map(conge => (
                                                                    <div key={conge.id} style={{ background: 'white', padding: '8px 12px', borderRadius: '8px', fontSize: '12px', border: '1px solid var(--border)', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                                        <span><strong>{conge.type || 'CP'}</strong> : {new Date(conge.dateDebut + 'T00:00:00').toLocaleDateString('fr-FR')} ‚Üí {new Date(conge.dateFin + 'T00:00:00').toLocaleDateString('fr-FR')}</span>
                                                                        <button onClick={() => handleDeleteConge(emp.id, conge.id)} style={{ background: 'var(--danger)', color: 'white', border: 'none', borderRadius: '4px', padding: '2px 6px', cursor: 'pointer', fontSize: '11px' }}>‚úï</button>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </td>
                                                    </tr>
                                                )}
                                            </React.Fragment>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>

                    {showModal && (
                        <EmployeeModal
                            employee={editingEmployee}
                            onSave={handleSaveEmployee}
                            onClose={() => { setShowModal(false); setEditingEmployee(null); }}
                        />
                    )}

                    {showCongeModal && (
                        <CongeModal
                            employee={selectedEmployee}
                            onSave={handleSaveConge}
                            onClose={() => { setShowCongeModal(false); setSelectedEmployee(null); }}
                        />
                    )}
                </div>
            );
        }

        // ‚îÄ‚îÄ‚îÄ EMPLOYEE MODAL ‚îÄ‚îÄ‚îÄ
        function EmployeeModal({ employee, onSave, onClose }) {
            const [formData, setFormData] = useState(employee || { nom: '', qualification: '', telephone: '', email: '' });
            const handleSubmit = (e) => { e.preventDefault(); onSave(formData); };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <h3>{employee ? 'Modifier l\'employ√©' : 'Nouvel employ√©'}</h3>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Nom complet</label>
                                <input type="text" value={formData.nom} onChange={e => setFormData({ ...formData, nom: e.target.value })} required />
                            </div>
                            <div className="form-group">
                                <label>Qualification</label>
                                <input type="text" value={formData.qualification} onChange={e => setFormData({ ...formData, qualification: e.target.value })} placeholder="Ex: Ma√ßon, √âlectricien..." />
                            </div>
                            <div className="form-grid">
                                <div className="form-group">
                                    <label>T√©l√©phone</label>
                                    <input type="tel" value={formData.telephone} onChange={e => setFormData({ ...formData, telephone: e.target.value })} />
                                </div>
                                <div className="form-group">
                                    <label>Email</label>
                                    <input type="email" value={formData.email} onChange={e => setFormData({ ...formData, email: e.target.value })} />
                                </div>
                            </div>
                            <div className="modal-actions">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>Annuler</button>
                                <button type="submit" className="btn btn-edit">Enregistrer</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // ‚îÄ‚îÄ‚îÄ CONGE MODAL ‚îÄ‚îÄ‚îÄ
        function CongeModal({ employee, onSave, onClose }) {
            const [formData, setFormData] = useState({ type: 'CP', dateDebut: '', dateFin: '' });
            const handleSubmit = (e) => { e.preventDefault(); onSave(formData); };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <h3>Ajouter un cong√©</h3>
                        <p style={{ color: 'var(--text-light)', marginBottom: '18px', fontSize: '13px' }}>Employ√© : {employee.nom}</p>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Type de cong√©</label>
                                <select value={formData.type} onChange={e => setFormData({ ...formData, type: e.target.value })} required>
                                    <option value="CP">Cong√© Pay√© (CP)</option>
                                    <option value="RTT">RTT</option>
                                    <option value="Maladie">Maladie</option>
                                    <option value="Sans solde">Sans solde</option>
                                    <option value="Autre">Autre</option>
                                </select>
                            </div>
                            <div className="form-grid">
                                <div className="form-group">
                                    <label>Date de d√©but</label>
                                    <input type="date" value={formData.dateDebut} onChange={e => setFormData({ ...formData, dateDebut: e.target.value })} required />
                                </div>
                                <div className="form-group">
                                    <label>Date de fin</label>
                                    <input type="date" value={formData.dateFin} onChange={e => setFormData({ ...formData, dateFin: e.target.value })} required />
                                </div>
                            </div>
                            <div className="modal-actions">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>Annuler</button>
                                <button type="submit" className="btn btn-edit">Ajouter</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // ‚îÄ‚îÄ‚îÄ CHANTIERS TAB ‚îÄ‚îÄ‚îÄ
        function ChantiersTab({ chantiers, employees, setChantiers }) {
            const [showModal, setShowModal] = useState(false);
            const [editingChantier, setEditingChantier] = useState(null);
            const [showAssignModal, setShowAssignModal] = useState(false);
            const [selectedChantier, setSelectedChantier] = useState(null);
            const [assignForm, setAssignForm] = useState({ employeeId: '', dateDebut: '', dateFin: '' });

            const handleSaveChantier = (chantierData) => {
                if (editingChantier) {
                    setChantiers(chantiers.map(c => c.id === editingChantier.id ? { ...chantierData, id: c.id, employees: c.employees } : c));
                } else {
                    setChantiers([...chantiers, { ...chantierData, id: Date.now(), employees: [] }]);
                }
                setShowModal(false);
                setEditingChantier(null);
            };

            const handleDeleteChantier = (id) => {
                if (confirm('Supprimer ce chantier ?')) {
                    setChantiers(chantiers.filter(c => c.id !== id));
                }
            };

            const handleAssignEmployee = (chantier) => {
                setSelectedChantier(chantier);
                setAssignForm({ employeeId: '', dateDebut: chantier.dateDebut, dateFin: chantier.dateFin });
                setShowAssignModal(true);
            };

            const submitAssignment = (e) => {
                e.preventDefault();
                setChantiers(chantiers.map(c => {
                    if (c.id === selectedChantier.id) {
                        return {
                            ...c,
                            employees: [...(c.employees || []), { ...assignForm, id: Date.now() }]
                        };
                    }
                    return c;
                }));
                setShowAssignModal(false);
                setSelectedChantier(null);
            };

            const removeAssignment = (chantierId, assignmentId) => {
                if (confirm('Retirer cet employ√© du chantier ?')) {
                    setChantiers(chantiers.map(c => {
                        if (c.id === chantierId) {
                            return {
                                ...c,
                                employees: c.employees.filter(a => a.id !== assignmentId)
                            };
                        }
                        return c;
                    }));
                }
            };

            return (
                <div className="card">
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                        <h3>Gestion des chantiers</h3>
                        <button className="btn btn-primary" onClick={() => setShowModal(true)}>+ Nouveau chantier</button>
                    </div>

                    {chantiers.length === 0 ? (
                        <p style={{ textAlign: 'center', color: 'var(--text-light)', padding: '40px 0' }}>Aucun chantier enregistr√©</p>
                    ) : (
                        chantiers.map(chantier => (
                            <div key={chantier.id} className="chantier-item">
                                <div className="chantier-header">
                                    <div className="chantier-info">
                                        <h4>{chantier.nom}</h4>
                                        <p>üìç {chantier.lieu}</p>
                                        <p>Du {new Date(chantier.dateDebut + 'T00:00:00').toLocaleDateString('fr-FR')} au {new Date(chantier.dateFin + 'T00:00:00').toLocaleDateString('fr-FR')}</p>
                                        <span className="badge badge-zone">Zone {chantier.zone} ‚Äì Panier: {chantier.panier}‚Ç¨</span>
                                    </div>
                                    <div style={{ display: 'flex', gap: '6px' }}>
                                        <button className="btn btn-secondary" onClick={() => handleAssignEmployee(chantier)}>Assigner</button>
                                        <button className="btn btn-edit" onClick={() => { setEditingChantier(chantier); setShowModal(true); }}>Modifier</button>
                                        <button className="btn btn-delete" onClick={() => handleDeleteChantier(chantier.id)}>Supprimer</button>
                                    </div>
                                </div>
                                {chantier.employees && chantier.employees.length > 0 && (
                                    <div className="employee-assignments">
                                        <h4 style={{ fontSize: '13px', marginBottom: '10px', color: 'var(--primary)' }}>Employ√©s assign√©s :</h4>
                                        {chantier.employees.map(assignment => {
                                            const emp = employees.find(e => e.id === assignment.employeeId);
                                            return emp ? (
                                                <div key={assignment.id} className="assignment-item">
                                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                        <div>
                                                            <strong style={{ fontSize: '13px' }}>{emp.nom}</strong>
                                                            <p style={{ fontSize: '12px', color: 'var(--text-light)', margin: '3px 0 0 0' }}>
                                                                Du {new Date(assignment.dateDebut + 'T00:00:00').toLocaleDateString('fr-FR')} au {new Date(assignment.dateFin + 'T00:00:00').toLocaleDateString('fr-FR')}
                                                            </p>
                                                        </div>
                                                        <button className="btn btn-delete" style={{ padding: '5px 10px', fontSize: '11px' }} onClick={() => removeAssignment(chantier.id, assignment.id)}>Retirer</button>
                                                    </div>
                                                </div>
                                            ) : null;
                                        })}
                                    </div>
                                )}
                            </div>
                        ))
                    )}

                    {showModal && (
                        <ChantierModal
                            chantier={editingChantier}
                            employees={employees}
                            onSave={handleSaveChantier}
                            onClose={() => { setShowModal(false); setEditingChantier(null); }}
                        />
                    )}

                    {showAssignModal && (
                        <div className="modal-overlay">
                            <div className="modal">
                                <h3>Assigner un employ√©</h3>
                                <p style={{ color: 'var(--text-light)', marginBottom: '18px', fontSize: '13px' }}>Chantier : {selectedChantier.nom}</p>
                                <form onSubmit={submitAssignment}>
                                    <div className="form-group">
                                        <label>Employ√©</label>
                                        <select value={assignForm.employeeId} onChange={e => setAssignForm({ ...assignForm, employeeId: e.target.value })} required>
                                            <option value="">S√©lectionner...</option>
                                            {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.nom}</option>)}
                                        </select>
                                    </div>
                                    <div className="form-grid">
                                        <div className="form-group">
                                            <label>Date de d√©but</label>
                                            <input type="date" value={assignForm.dateDebut} onChange={e => setAssignForm({ ...assignForm, dateDebut: e.target.value })} min={selectedChantier.dateDebut} max={selectedChantier.dateFin} required />
                                        </div>
                                        <div className="form-group">
                                            <label>Date de fin</label>
                                            <input type="date" value={assignForm.dateFin} onChange={e => setAssignForm({ ...assignForm, dateFin: e.target.value })} min={selectedChantier.dateDebut} max={selectedChantier.dateFin} required />
                                        </div>
                                    </div>
                                    <div className="modal-actions">
                                        <button type="button" className="btn btn-secondary" onClick={() => { setShowAssignModal(false); setSelectedChantier(null); }}>Annuler</button>
                                        <button type="submit" className="btn btn-edit">Assigner</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // ‚îÄ‚îÄ‚îÄ CHANTIER MODAL ‚îÄ‚îÄ‚îÄ
        function ChantierModal({ chantier, employees, onSave, onClose }) {
            const [formData, setFormData] = useState(chantier || { nom: '', lieu: '', dateDebut: '', dateFin: '', zone: '', panier: '' });
            const handleSubmit = (e) => { e.preventDefault(); onSave(formData); };

            return (
                <div className="modal-overlay">
                    <div className="modal">
                        <h3>{chantier ? 'Modifier le chantier' : 'Nouveau chantier'}</h3>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Nom du chantier</label>
                                <input type="text" value={formData.nom} onChange={e => setFormData({ ...formData, nom: e.target.value })} required />
                            </div>
                            <div className="form-group">
                                <label>Lieu de travail (adresse compl√®te)</label>
                                <textarea value={formData.lieu} onChange={e => setFormData({ ...formData, lieu: e.target.value })} rows="3" required placeholder="Ex: 123 Rue de la Paix, 59000 Lille" />
                            </div>
                            <div className="form-grid">
                                <div className="form-group">
                                    <label>Date de d√©but</label>
                                    <input type="date" value={formData.dateDebut} onChange={e => setFormData({ ...formData, dateDebut: e.target.value })} required />
                                </div>
                                <div className="form-group">
                                    <label>Date de fin</label>
                                    <input type="date" value={formData.dateFin} onChange={e => setFormData({ ...formData, dateFin: e.target.value })} required />
                                </div>
                            </div>
                            <div className="form-grid">
                                <div className="form-group">
                                    <label>Zone</label>
                                    <input type="text" value={formData.zone} onChange={e => setFormData({ ...formData, zone: e.target.value })} placeholder="Ex: 1, 2, 3..." />
                                </div>
                                <div className="form-group">
                                    <label>Panier repas (‚Ç¨)</label>
                                    <input type="number" step="0.01" value={formData.panier} onChange={e => setFormData({ ...formData, panier: e.target.value })} placeholder="Ex: 10.50" />
                                </div>
                            </div>
                            <div className="modal-actions">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>Annuler</button>
                                <button type="submit" className="btn btn-edit">Enregistrer</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // ‚îÄ‚îÄ‚îÄ EXPORT TAB ‚îÄ‚îÄ‚îÄ
        function ExportTab({ employees, onExport }) {
            const [selectedEmployee, setSelectedEmployee] = useState('');

            return (
                <div className="card">
                    <h3>Exporter les plannings</h3>
                    <div className="export-section">
                        <h4>S√©lectionner un employ√©</h4>
                        <p style={{ color: 'var(--text-light)', marginBottom: '14px', fontSize: '13px' }}>
                            Le planning annuel sera export√© au format Excel color√© avec un onglet par mois et un r√©sum√© CP
                        </p>
                        <div className="form-grid">
                            <div className="form-group">
                                <label>Employ√©</label>
                                <select value={selectedEmployee} onChange={e => setSelectedEmployee(e.target.value)}>
                                    <option value="">S√©lectionner...</option>
                                    {employees.map(emp => <option key={emp.id} value={emp.id}>{emp.nom}</option>)}
                                </select>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'flex-end' }}>
                                <button className="btn btn-edit" onClick={() => selectedEmployee && onExport(selectedEmployee)} disabled={!selectedEmployee} style={{ width: '100%' }}>
                                    üì• Exporter le planning
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
